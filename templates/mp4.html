{% extends "layout.html" %}
{% load static %}
{% block style %}
main {
    min-height: 90vh; 
}
{% endblock style %}
{% block bodyContent %}
<div class="w-full overflow-x-hidden">
<header class="disapper bg-gray-950 flex items-center justify-between px-5 gap-2 py-4" id="header">
    <div class="disappear flex justify-start gap-5 items-center">
        <a href="/" class="text-yellow-600 text-xl hover:shadow-md hover:shadow-white transition-all duration-150 ease-in-out capitalise">KINGSTONEMOVIES</a>
        <p class="text-white hidden sm:block text-lg">HD movies at the smallest file size.</p>
    </div> 

    <!--Search form-->
    <form action="/search/" class="hidden lg:flex xl:w-1/2 justify-start items-center bg-gray-600 bg-opacity-30 py-1 border border-md border-gray-700 border-opacity-50 rounded-md overflow-hidden">
        <span class="inline-flex items-center px-3 text-sm text-gray-900  border border-e-0 rounded-s-md  dark:text-gray-400 border-none">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-5 ">
                <path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd" />
            </svg>
            
        </span>
        <input type="text" id="searchName" class=" bg-gray-700 bg-opacity-0 border-none focus:border-none focus:ring-0 outline-none text-white text-opacity-90" placeholder="Search">
        <button></button>
    </form>

    <!--Search icon-->
   <div>
    
        
       
        
        <div class="flex justify-end items-center gap-2 lg:hidden">
            <!--Activate search bar-->
            <div id="searchActivator" class="hover:cursor-pointer ">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-8 text-white inline-block hover:text-sky-300 transition-all duration-150 ease">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                </svg>
              
            </div>
            <!--Browse Movies-->
            <form action="/multi-media/movies/">
                <input type="text" value="movies" name="type" class="hidden">
                <button class="font-bold hover:text-blue-500 inline-block text-blue-700 font-sans transition-all duration-100 ease" title="Browse Movies" ><svg class="w-10 h-10 font-bold hover:text-blue-500 inline-block text-blue-700 font-sans transition-all duration-100 ease" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 9h6m-6 3h6m-6 3h6M6.996 9h.01m-.01 3h.01m-.01 3h.01M4 5h16a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1Z"/>
                  </svg></button>
            </form>

            <!--browse series-->
            <form action="/multi-media/tvShows/">
                <input type="text" value="series" name="type" class="hidden">
                <button class="font-bold hover:text-red-500 inline-block text-red-700 font-sans transition-all duration-100 ease" title="Browse Series" ><svg class="w-10 h-10 font-bold hover:text-red-500 inline-block text-red-700 font-sans transition-all duration-100 ease" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 9h6m-6 3h6m-6 3h6M6.996 9h.01m-.01 3h.01m-.01 3h.01M4 5h16a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1Z"/>
                  </svg></button>
            </form>
        </div>
        <div class="hidden lg:gap-2 lg:flex justify-end items-center" id="listMenu">
            <a href="/" class="text-white text-opacity-70 font-sans font-bold hover:text-opacity-95 transition-all duration-100 ease">Home</a>
            <form action="/multi-media/movies/">
                <input type="text" value="movies" name="type" class="hidden">
                <button class="font-bold hover:text-blue-500 inline-block text-blue-700 font-sans transition-all duration-100 ease">Browse Movies</button>
            </form>
            <form action="/multi-media/tvShows/">
                <input type="text" value="series" name="type" class="hidden">
                <button class="font-bold hover:text-red-500 inline-block text-red-700 font-sans transition-all duration-100 ease">Browse Series</button>
            </form>
            <a href="/membership/register/" class="font-bold hover:text-yellow-300 inline-block text-yellow-500 font-sans transition-all duration-100 ease">Join US</a>
        </div>
         
</header>

<main class="bg-black bg-opacity-50 w-full flex flex-col justify-between gap-7">
    {% if context.buyer %}
    <span>
    <div class="h-0 transition-all duration-200 ease-linear bg-gray-800" id="searchForm">
        <form action="/" class=" hidden w-4/5 m-auto" id="searchFormButton">
            <label for="searchTerm" class="text-white text-opacity-60 text-xl py-3">Search Term:</label>
            <span class="flex items-center justify-center gap-4">
            <input type="text" autofocus placeholder="Search for a series" name="searchTerm" class=" bg-gray-400 py-1 px-2 bg-opacity-20 w-full border-none focus:border-none focus:ring-0 outline-none text-white text-opacity-90 rounded-md">
            <button class="bg-blue-600  py-1 px-2 border-none focus:border-none focus:ring-0 outline-none text-white text-opacity-90 rounded-md">Search</button>
        </span>
        </form>
    </div>
        <!--movie Details-->
    <div class="px-3 pt-5">
        <p class="text-gray-200  capitalize font-sans font-bold text-xl">{{context.videoDetails.title}}</p>
        <p class="text-gray-200 text-lg font-sans pb-3 capitalize">{{context.videoDetails.season}}</p>
    </div>
    <img src="{{context.videoDetails.image.url}}" alt="" class="absolute top-0 right-0 -z-10 h-full object-fill w-full">
    <div class="min-h-full md:w-4/5 xl:w-3/4 grid grid-cols-2 sm:grid sm:grid-cols-3 gap-2 md:m-auto px-3 pt-5">
       
        <div class="col-span-2 grid  grid-cols-3 gap-4 ">
            <!--video details-->
            <div class="col-span-2">
               
                <img src="{{context.videoDetails.image.url}}" class="h-2/3 w-full block rounded-md border-gray-300 shadow-sm shadow-white border-2" alt="">
                {% if not context.cartExist %}
                <form action="/cart/" method="post">
                    {% csrf_token %}
                    <input type="text" name="videoName" value="{{context.videoDetails.title}}" hidden>
                    <button class="w-full text-white bg-blue-400 mt-3 py-1 font-sans font-bold rounded-md text-lg hover:text-blue-400 hover:bg-white transition-all duration-150 ease-linear ">Add Cart</button>
                </form>
                {% endif %}
                <p class="w-full text-center text-white bg-blue-400 my-3 py-1 font-sans font-bold rounded-md text-lg hover:cursor-pointer downloadButtonActivator hover:text-blue-400 hover:bg-white transition-all duration-150 ease-linear "  >Download</p>
            </div>
            <div class="">

                <!--likes-->
                <div class="grid grid-cols-2 px-1">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="green" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 text-green-700">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
                    </svg>
                    <p class="text-white font-bold">2000</p>
                </div>

                <!--imdb-->
                <div class="grid grid-cols-2 items-center mt-3">
                    <?xml version="1.0" ?><!DOCTYPE svg  PUBLIC '-//W3C//DTD SVG 1.1//EN'  'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'><svg height="2rem" style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="3rem" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="_x31_71-imdb"><g><g><g><path d="M436.714,26.001H75.287c-27.21,0-49.285,22.075-49.285,49.286v361.427      c0,27.211,22.075,49.285,49.285,49.285h361.427c27.211,0,49.284-22.074,49.284-49.285V75.287      C485.998,48.076,463.925,26.001,436.714,26.001z" style="fill:#FBBF14;"/></g></g><rect height="131.222" style="fill:#273238;" width="33.883" x="91.716" y="190.287"/><path d="M241.831,321.509h-29.469v-88.714l-11.912,88.714H179.3l-12.528-86.763v86.763h-29.776V190.287    h43.947c3.39,20.329,6.16,40.968,8.934,61.504l7.803-61.504h44.152V321.509z" style="fill:#273238;display:block;"/><path d="M330.544,236.8c0-8.317,0.31-17.25-1.438-25.055c-4.414-23.102-32.24-21.458-50.311-21.458h-25.261    v131.222C341.942,321.612,330.544,327.669,330.544,236.8z M287.522,298.713v-85.94c12.219,0,10.576,6.47,10.576,16.428v50.622    C298.099,289.781,300.049,299.022,287.522,298.713z" style="fill:#273238;"/><path d="M395.949,223.656c-9.137,0-15.298,2.773-21.457,9.447v-42.816h-32.55v131.222h30.597l1.953-8.317    c5.852,6.982,12.218,10.063,21.457,10.063c20.331,0,22.795-15.607,22.795-31.729v-36.963    C418.744,236.8,417.923,223.656,395.949,223.656z M379.522,304.362c-1.642,0-3.081-0.823-3.902-2.465    c-2.26-5.237-1.128-45.281-1.128-45.897c0-3.901-1.132-13.04,5.03-13.04c7.496,0,6.364,7.496,6.364,13.04v33.574    C385.887,295.12,387.53,304.362,379.522,304.362z" style="fill:#273238;"/></g></g><g id="Layer_1"/></svg>
                    <p class="text-white font-bold">7.4</p>
                </div>

                <!--cost-->
                <div class="grid grid-cols-2 px-1">
                    <p class="text-white font-bold capitalize">cost</p>
                    <p class="text-white font-bold">Ksh. <span>{{context.videoDetails.price}}</span></p>
                </div>

                <!--Downloads Download page-->
                <div class="my-3 mx-1 bg-black bg-opacity-30 p-1 grid place-content-center border-gray-500 border-2 rounded-md hover:cursor-pointer transition-all duration-150 ease-linear hover:shadow-sm hover:shadow-sky-300 " >
                    {% for qulty in context.videoDetails.Quality %}
                        <p class="text-blue-400">{{qulty}}</p>
                    {% endfor %}
                      
                </div>
                <div class="my-3 mx-1 bg-black bg-opacity-30 p-1 grid place-content-center border-gray-500 border-2 rounded-md hover:cursor-pointer transition-all duration-150 ease-linear hover:shadow-sm hover:shadow-sky-300 downloadButtonActivator" >
                    <svg class="w-6 h-6 text-blue-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 13V4M7 14H5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1h-2m-1-5-4 5-4-5m9 8h.01"/>
                      </svg>
                      
                </div>

                <!--watch playPage-->
                <div class="my-3 mx-1 bg-black bg-opacity-30 p-1 grid place-content-center border-gray-500 border-2 rounded-md hover:cursor-pointer transition-all duration-150 ease-linear hover:shadow-sm hover:shadow-sky-300" id="playTrailer">
                    <svg class="w-6 h-6 text-blue-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v5m-3 0h6M4 11h16M5 15h14a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H5a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1Z"/>
                      </svg>
                      
                </div>
                <!--Account balance-->
                <p id="accountBalance" class="hidden">{{context.user.account}}</p>
                <!--video container-->
                <div class="fixed top-0 left-0 w-full h-full overflow-scroll z-20 bg-white hidden items-start" id="trailerVideoContainer">

                    <div class="mb-2" id="cancelTrailer">
                        <svg class="w-6 text-2xl font-extrabold  h-6 text-black block hover:cursor-pointer" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"/>
                          </svg>
                          
                    </div>
                    <section class="flex justify-start w-full m-auto gap-4 pt-6 px-3 " id="vidzContainer">
                        {% for vids in context.video %}
                            {% if vids.quality == context.videolity %}
                                <form action="/play/" class="max-w-56 overflow-hidden rounded-md bg-gray-600">
                                    <input type="text" name="videoNae" value="{{vids.video}}" hidden>
                                    <input type="text" name="name" value="{{vids.name}}" hidden>
                                    <input type="text" name="quality" value={{context.videolity}} hidden>
                                    <button class=" hover:shadow-md hover:shadow-sky-400 pb-3 transition-all duration-300 ease-out max-w-56" id="{{vids.video}}">
                                    
                                        <video  muted class="inline-block object-cover max-w-56 vidaz" id="{{vids.video}}">
                                            <source src="{{vids.video.url}}" type="video/mp4">
                                            <source src="{{vids.video.url}}" type="video/ogg">
                                            Your browser does not support the video tag.
                                        </video>
                                        <span class = "text-white w-full overflow-hidden">
                                            <p class="videoLabel whitespace-nowrap text-black" id="{{vids.video}}"></p>
                                        </span>
                                    </button>
                                </form>
                            {% endif %}  
                    {% endfor %}

                    </section>
                    
                </div>
            </div>

        </div>

        <!--trending-->
        <div class="mx-2 hidden">
            <h3 class="text-white font-bold text-lg font-sans mb-5">Trending:</h3>
            <div class="flex flex-wrap gap-2 items-start justify-start">
                {% for vidas in context.trending %}
                <form action="/mp4/" class="overflow-hidden hover:shadow-md hover:shadow-sky-400 pb-3 transition-all duration-300 ease-out bg-gray-500 bg-opacity-55 rounded-sm mb-4">
                    <input type="text" name="videoTitle" value="{{vidas.title}}" hidden>
                    <button class="block max-w-28">
                        <img src="{{vidas.image.url}}" alt="Movie img" class="inline-block object-fill w-full h-48" id="categoryFormImg">
                        <div>
                            <p class="w-fullcapitalize text-white opacity-80 text-center pt-2 font-sans text-sm" id="categoryFormP">{{vidas.title}}</p>
                        </div>
                    </button>
                </form>
                {% endfor %}
            </div>
        </div>


    </div>
</span>
    <div class="bg-black opacity-60 w-full">
        <p class="capitalize text-lg text-white font-bold p-4">Synopsis Of {{context.videoDetails.title}} Torrent On Flixshow:</p>
        <p class=" p-4 text-white md:w-1/2">Movie Story : {{context.videoDetails.synopsis}}... </p>
    </div>
    {% else %}
    <p class="text-xl font-sans">You Account is not Authorised to perform Some functions in thes platform. <a class="text-sky-700" href="/message">Please Contact for any query</a>. </p>
    {% endif %}
</main>


<!--Download page-->

<div class="fixed hidden top-0 backdrop-blur-sm bg-black bg-opacity-40 w-screen h-full" id="downloadSection">
    <div class="bg-black mt-24 w-4/5 md:w-2/3 2xl:w-1/2 m-auto p-2 rounded-md">
        <div id="cancelDownload" class="flex justify-end items-end text-left">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6 block w-full hover:cursor-pointer text-white opacity-60">
                <path fill-rule="evenodd" d="M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
              </svg>
        </div>
        <p class="text-green-400 tracking-widest text-center font-sans text-lg mt-3 mb-6">Download movieName</p>
        <table class="text-white w-full  p-3 text-center text-lg">
            <thead >
                <th>Name</th>
                <th>Size</th>
                <th>Quality</th>
                <th>Cost</th>
                <th>Download</th>
                
            </thead>
            
            <tbody>
                {% for qulty in context.videoDetails.Quality %}
                    <tr class=" border-white border-t-2 border-opacity-30">
                        <td class="text-center pt-4 px-3 text-opacity-80 text-white capitalize">{{context.videoDetails.title}}</td>

                        <td class="text-center pt-4 px-3 text-opacity-80 text-white uppercase">900mb</td>

                        <td class="text-center pt-4 px-3 text-opacity-80 text-white capitalize">{{qulty}}</td>
                        <td class="text-center pt-4 px-3 text-opacity-80 text-white capitalize">{{context.videoDetails.price}}</td>
                        <!--cost--> 
                    
                        <span id="cost" class="hidden">{{context.videoDetails.price}}</span>
                       <form action="/download/" class="hidden" method="post">
                            {% csrf_token %}
                            <input type="text" value="{{context.videoDetails.title}}" name="videoTitle" hidden>
                            <input type="number" value="{{context.videoDetails.price}}" name="price" hidden>
                            
                            <button class="hover:text-sky-400 downloadButtn">{{qulty}}</button>
                        </form>
                    <td class="text-center pt-4 px-3 text-opacity-80 text-white capitalize">
                        <button class="hover:text-sky-400 downloadButtn" id="{{qulty}}">Download</button>
                    </td>
                    </tr>
                    {% for vidz in context.video %}
                        {% if vidz.quality == qulty %}
                        <tr class=" border-white border-t-2 border-opacity-30 col-span-5 hidden">
                            <a href="{{vidz.video.url}}" class="text-center pt-4 px-3 text-opacity-80 text-white vida capitalize hidden" download target="_blank">{{vidz.quality}}</a>
                        </tr>
                        {% endif %}
                    {% endfor %}
                {%endfor%}
            </tbody>

        </table>
    </div>
</div>
</div>

<script>
    const searchActivator = document.getElementById("searchActivator")
    const searchForm = document.getElementById("searchForm")
    const searchFormButton = document.getElementById("searchFormButton")
    const cancelDownload = document.getElementById("cancelDownload")
    const downloadSection = document.getElementById("downloadSection")
    const downloadButtonActivator= document.getElementsByClassName("downloadButtonActivator")
    const cost = document.getElementById("cost")
    const cancelTrailer = document.getElementById("cancelTrailer")
    const trailerVideoContainer = document.getElementById("trailerVideoContainer")
    const playTrailer = document.getElementById("playTrailer")
    const accountBalance = document.getElementById("accountBalance")
    const vidaz = document.getElementsByClassName("vidaz")
    const videos = document.querySelectorAll("video")
    let searchActivated = false
    searchActivator.addEventListener('click', function() {
        if(!searchActivated){
            searchForm.style.height = "fit-content"
            searchForm.style.paddingTop = "1.8rem"
            searchForm.style.paddingBottom = "1.8rem"
            searchFormButton.style.display = "block"
            searchActivated = true
        } else {
            searchFormButton.style.display = "none"
            searchForm.style.height = "0"
            searchForm.style.paddingTop = "0"
            searchForm.style.paddingBottom = "0"
            searchActivated = false
        }
        
    })

    cancelDownload.addEventListener("click", ()=> {
        downloadSection.classList.add("hidden")
    })
    for (const d_ButtonActivator of downloadButtonActivator) {
        d_ButtonActivator.addEventListener("click", ()=> {
           const movieCost = Number(cost.innerText)
           //error
           //If the cost is less then amount download enable else tellthe client to deposit
           const accountAmount = Number(accountBalance.innerText)
           

           if(accountAmount >= movieCost){
            downloadSection.classList.remove("hidden")
           } else {
            if(window.confirm("insufficient Funds, Deposit")){
                window.location.assign("/deposit/")
            }
            
           }
           
        })
    }
    
    //trailer container stop

    cancelTrailer.addEventListener("click", ()=> {
        trailerVideoContainer.style.display = "none"
        for (const vids of videos) {
            //vids.stop()
            vids.load()
        }
    })

    //episodes play
    playTrailer.addEventListener("click", ()=> {
        //trailerVideoContainer.classList.remove("hidden")
        trailerVideoContainer.style.display = "block"
        for (const vids of videos) {
            vids.currentTime = 10
            vids.play()
            vids.playbackRate = 4
            setInterval(()=> {
                if (vids.currentTime > 20) {
                    vids.currentTime = 10
                    vids.play()
                    vids.playbackRate = 2
                    
                }
            }, 100)
        }
       
    })
//Download
    const downloadButton = document.getElementsByClassName("downloadButtn")
    const video = document.getElementsByClassName("vida")
    const buttons = document.querySelectorAll("button")

    for(const dwd of downloadButton) {
        dwd.addEventListener("click", ()=> {
           for (const vid of video) {
                setTimeout(()=> {
                    if (vid.innerText == dwd.id) {
                        vid.click()
                        console.log("video downloading")
                       }
                   
                }, 200)
               
            }
            for (const btn of buttons){
                if (btn.innerText == dwd.id) {
                    btn.click()
                }
            }
       })

    }

    //videos play section
    
    const videoLabel = document.querySelectorAll(".videoLabel")
    const vidzContainer = document.getElementById("vidzContainer")

 
       

        for(const vidzLabel of videoLabel) {
            if (vidzLabel.id == vids.id){
                vidzLabel.innerText = vids.id.split("/")[1].split(".")[0] 
            }
        }
    
   
</script>
{% endblock bodyContent %}
